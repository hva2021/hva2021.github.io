function upkeep(){if(!window.paused){window.nextupk=setTimeout(upkeep,timer);for(var e=window.speed;e>0;--e)adjustFPS(),QuadsKeeper.determineAllQuadrants(solids),maintainSolids(),maintainCharacters(),maintainPlayer(),texts.length&&maintainTexts(),TimeHandler.handleEvents(),refillCanvas()}}function adjustFPS(){window.time_now=now();var e=time_now-time_prev,a=roundDigit(1e3/e,.001);window.fps=roundDigit(.7*fps+.3*a,.01),window.realtime=fps_target/fps,window.time_prev=time_now}function pause(e){paused&&!window.nextupk||(cancelAnimationFrame(nextupk),AudioPlayer.pause(),paused=!0,e&&AudioPlayer.play("Pause"))}function unpause(){paused&&(window.nextupk=requestAnimationFrame(upkeep),paused=!1,AudioPlayer.resume())}function maintainSolids(e){for(var a,n=0;n<solids.length;++n)(a=solids[n]).alive&&a.movement&&a.movement(a),(!a.alive||a.right<QuadsKeeper.getDelX())&&deleteThing(a,solids,n)}function maintainCharacters(e){var a,n,i=gamescreen.right+QuadsKeeper.getOutDifference();for(n=0;n<characters.length;++n)(a=characters[n]).resting?a.yvel=0:(a.nofall||(a.yvel+=a.gravity||map.gravity),a.yvel=min(a.yvel,map.maxyvel)),updatePosition(a),QuadsKeeper.determineThingQuadrants(a),a.under=a.undermid=!1,determineThingCollisions(a),a.resting&&(characterOnResting(a,a.resting)?(a.yvel=!1,setBottom(a,a.resting.top)):a.resting=!1),a.alive?"player"==a.type||map.shifting||!(0==a.numquads||a.left>i)||a.outerok?!a.nomove&&a.movement&&a.movement(a):deleteThing(a,characters,n):map.shifting||deleteThing(a,characters,n)}function maintainPlayer(e){if(player.alive){if(player.yvel>0&&(map.underwater||(player.keys.jump=0),player.jumping||(map.underwater?player.paddling||(switchClass(player,"paddling","paddling"),player.padding=!0):(addClass(player,"jumping"),player.jumping=!0)),!player.piping&&!player.dying&&player.top>gamescreen.deathheight)){if(map.exitloc)return map.random?(goToTransport(["Random","Overworld","Down"]),void playerDropsIn()):shiftToLocation(map.exitloc);clearPlayerStats(),killPlayer(player,2)}player.xvel>0?player.right>gamescreen.middlex&&player.right>gamescreen.right-gamescreen.left&&(player.xvel=min(0,player.xvel)):player.left<0&&(player.xvel=max(0,player.xvel)),player.under&&(player.jumpcount=0),window.scrolloffset=map.canscroll*(player.right-gamescreen.middlex),scrolloffset>0&&!map.shifting?scrollWindow(lastscroll=round(min(player.scrollspeed,scrolloffset))):lastscroll=0}}function maintainTexts(){var e,a,n;for(n=texts.length-1;n>=0;--n)e=(a=texts[n]).element||a,a.xvel&&elementShiftLeft(e,a.xvel),a.yvel&&elementShiftTop(e,a.yvel)}