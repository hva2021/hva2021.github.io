function followPath(e,t,i){return null!=t[i]&&null!=e[t[i]]?followPath(e[t[i]],t,++i):e}function clearAllTimeouts(){for(var e=setTimeout((function(){}));e--;)clearTimeout(e)}function getCanvas(e,t,i){var n=createElement("canvas",{width:e,height:t});return i&&(i=i||unitsize,proliferate(n.style,{width:e*i+"px",height:t*i+"px"})),n.getContext("2d").webkitImageSmoothingEnabled=!1,n}function step(e){unpause(),upkeep(),pause(),e>0&&step(e-1)}function fastforward(e){window.speed=max(0,parseInt(e||0))+1}function toggleFastFWD(e){window.fastforwarding?(fastforward(0),window.fastforwarding=!1):(fastforward(2),window.fastforwarding=!0)}function specifyTimer(e){timer=e,requestAnimationFrame=function(e){window.setTimeout(e,timer)}}function changeUnitsize(e){function t(e){for(i in e)updateSize(e[i]),updatePosition(e[i])}e&&(resetUnitsize(e),t(solids),t(characters))}function randTrue(e){return floor(getSeed()*((e||1)+1))}function randSign(e){return 2*randTrue(e)-1}function randBoolJS(e){return floor(2*random())}function updatePosition(e){e.nomove||shiftHoriz(e,e.xvel),e.nofall||shiftVert(e,e.yvel)}function updateSize(e){var t;e.unitwidth=e.width*unitsize,e.unitheight=e.height*unitsize,e.spritewidthpixels=e.spritewidth*unitsize,e.spriteheightpixels=e.spriteheight*unitsize,(t=e.canvas)&&(t.width=e.spritewidthpixels,t.height=e.spriteheightpixels,refillThingCanvas(e))}function reduceHeight(e,t,i){e.top+=t,e.height-=t/unitsize,i&&updateSize(e)}function shiftBoth(e,t,i){e.noshiftx||shiftHoriz(e,t),e.noshifty||shiftVert(e,i)}function shiftHoriz(e,t){e.left+=t,e.right+=t}function shiftVert(e,t){e.top+=t,e.bottom+=t}function setLeft(e,t){e.left=t,e.right=e.left+e.width*unitsize}function setRight(e,t){e.right=t,e.left=e.right-e.width*unitsize}function setTop(e,t){e.top=t,e.bottom=e.top+e.height*unitsize}function setBottom(e,t){e.bottom=t,e.top=e.bottom-e.height*unitsize}function setWidth(e,t,i,n){e.width=t,e.unitwidth=t*unitsize,i&&(e.spritewidth=t,e.spritewidthpixels=t*unitsize),n&&(updateSize(e),setThingSprite(e))}function setHeight(e,t,i,n){e.height=t,e.unitheight=t*unitsize,i&&(e.spriteheight=t,e.spriteheightpixels=t*unitsize),n&&(updateSize(e),setThingSprite(e))}function setSize(e,t,i,n,o){t&&setWidth(e,t,n),i&&setHeight(e,i,n),o&&(updateSize(e),setThingSprite(e))}function setMidX(e,t,i){setLeft(e,t+e.width*unitsized2,i)}function getMidX(e){return e.left+e.width*unitsized2}function setMidY(e,t,i){setTop(e,t+e.height*unitsized2,i)}function setMidXObj(e,t,i){setLeft(e,t.left+t.width*unitsized2-e.width*unitsized2,i)}function slideToXLoc(e,t,i,n){i=i||1/0;var o=getMidX(e);shiftHoriz(e,o<t?min(i,t-o):max(-i,t-o),n)}function updateLeft(e,t){e.left+=t,e.right=e.left+e.width*unitsize}function updateRight(e,t){e.right+=t,e.left=e.right-e.width*unitsize}function updateTop(e,t){e.top+=t,e.bottom=e.top+e.height*unitsize}function updateBottom(e,t){e.bottom+=t,e.top=e.bottom-e.height*unitsize}function increaseHeightTop(e,t,i){e.top-=t,e.height+=t/unitsize,e.unitheight=e.height*unitsize}function determineThingCollisions(e){if(!e.nocollide){var t,i,n,o,r,l,s;for(e.resting&&0!=e.resting.yvel||(e.resting=!1),e.skipoverlaps||checkOverlap(e),o=0,l=e.numquads;o<l;++o)for(i=(t=e.quadrants[o]).things,r=0,s=t.numthings;r<s&&e!=(n=i[r]);++r)!n.alive||n.scenery||n.nocollide||!objectsTouch(e,n)||!e.player&&n.hidden&&n.visual_scenery&&n.visual_scenery.hidden&&!solidOnCharacter(n,e)||(n.character?objectsCollided(e,n):e.nocollidesolid||(objectsCollided(e,n),e.skipoverlaps||n.skipoverlaps||!characterOverlapsSolid(e,n)||e.overlaps.push(n)));e.undermid?e.undermid.bottomBump(e.undermid,e):e.under instanceof Thing&&e.under.bottomBump(e.under,e)}}function checkOverlap(e){if(e.overlapdir)e.overlapdir<0&&e.right<=e.ocheck.left+unitsizet2||e.left>=e.ocheck.right-unitsizet2?(e.overlapdir=0,e.overlaps=[]):shiftHoriz(e,e.overlapdir,!0);else if(e.overlaps.length>0){var t,i,n=e.overlaps,o={right:-1/0},r={left:1/0},l=0;for(i in e.overlapfix=!0,n)l+=getMidX(t=n[i]),t.right>o.right&&(o=t),t.left<r.left&&(r=t);l/=n.length,getMidX(e)>=l-unitsized16?(e.overlapdir=unitsize,e.ocheck=o):(e.overlapdir=-unitsize,e.ocheck=r)}}function characterOverlapsSolid(e,t){return e.top<=t.top&&e.bottom>t.bottom}function objectsTouch(e,t){return e.right-unitsize>t.left&&e.left+unitsize<t.right&&e.bottom>=t.top&&e.top<=t.bottom}function charactersTouch(e,t){return!(e.bottom<=t.top+unitsizet2||e.top+unitsizet2>=t.bottom)}function objectInQuadrant(e,t){return e.right+unitsize>=t.left&&e.left-unitsize<=t.right&&e.bottom+unitsize>=t.top&&e.top-unitsize<=t.bottom}function objectsCollided(e,t){return e.solid&&!t.solid?objectsCollided(t,e):t.up&&e!=t.up?characterTouchesUp(e,t):void(t.solid||e.player?t.collide(e,t):e.collide(t,e))}function objectToLeft(e,t){return(e.left+e.right)/2<(t.left+t.right)/2}function objectOnTop(e,t){return!("solid"==e.type&&t.yvel>0)&&(!(e.yvel<t.yvel&&"solid"!=t.type)&&(!!(e.player&&e.bottom<t.bottom&&"enemy"==t.group)||e.left+unitsize<t.right&&e.right-unitsize>t.left&&(e.bottom-t.yvel<=t.top+t.toly||e.bottom<=t.top+t.toly+abs(e.yvel-t.yvel))))}function objectOnSolid(e,t){return e.left+unitsize<t.right&&e.right-unitsize>t.left&&(e.bottom-e.yvel<=t.top+t.toly||e.bottom<=t.top+t.toly+abs(e.yvel-t.yvel))}function solidOnCharacter(e,t){return!(t.yvel>=0)&&(t.midx=getMidX(t),t.midx>e.left&&t.midx<e.right&&e.bottom-e.yvel<=t.top+t.toly-t.yvel)}function characterOnSolid(e,t){return e.resting==t||objectOnSolid(e,t)&&e.yvel>=0&&e.left+e.xvel+unitsize!=t.right&&e.right-e.xvel-unitsize!=t.left}function characterOnResting(e,t){return objectOnSolid(e,t)&&e.left+e.xvel+unitsize!=t.right&&e.right-e.xvel-unitsize!=t.left}function characterTouchedSolid(e,t){if(t.up!=e){if(characterOnSolid(e,t)){if(t.hidden)return;e.resting=t,e.player&&map.underwater&&removeClass(e,"paddling")}else if(solidOnCharacter(t,e)){var i=e.left+e.width*unitsize/2;if(i>t.left&&i<t.right)e.undermid=t;else if(t.hidden)return;e.under?e.under.push(t):e.under=[t],e.player&&setTop(e,t.bottom-e.toly+t.yvel,!0),e.yvel=t.yvel,e.player&&(e.keys.jump=0)}t.hidden||characterNotBumping(e,t)||objectOnTop(e,t)||objectOnTop(t,e)||e.under||e==t.up||(e.right<=t.right?(e.xvel=min(e.xvel,0),shiftHoriz(e,max(t.left+unitsize-e.right,-unitsized2),!0)):e.left>=t.left&&(e.xvel=max(e.xvel,0),shiftHoriz(e,min(t.right-unitsize-e.left,unitsized2),!0)),e.player?t.actionLeft&&t.actionLeft(e,t,t.transport):(e.moveleft=!e.moveleft,"item"==e.group&&e.collide(t,e)))}}function characterNotBumping(e,t){return e.top+e.toly+abs(e.yvel)>t.bottom}function characterTouchesUp(e,t){switch(e.group){case"item":e.moveleft=getMidX(e)<=getMidX(t)+unitsized2,characterHops(e);break;case"coin":e.animate(e);break;default:e.death(e,2),scoreEnemyBelow(e)}}function characterHops(e){e.yvel=-1.4*unitsize,e.resting=!1}function characterIsAlive(e){return!(!e||e.dead||!e.alive)}function scorePlayerShell(e,t){return e.star?score(t,200,!0):t.resting?t.peeking?score(t,1e3,!0):score(t,100,!0):score(t,8e3,!0)}function scoreEnemyStomp(e){switch(e.type.split(" ")[0]){case"koopa":e.fly?400:100;break;case"bulletbill":case"cheepcheep":200;break;case"hammerbro":1e3;break;case"lakitu":800;break;default:100}}function scoreEnemyFire(e){var t=200;switch(e.type.split(" ")[0]){case"goomba":t=100;break;case"hammerbro":t=1e3;break;case"bowser":t=5e3;break;default:t=200}scoreEnemyFin(e,t)}function scoreEnemyStar(e){var t=200;switch(e.type.split(" ")[0]){case"goomba":t=100;break;case"hammerbro":t=1e3;break;default:t=200}scoreEnemyFin(e,t),AudioPlayer.play("Kick")}function scoreEnemyBelow(e){var t=100;switch(e.type.split(" ")[0]){case"hammerbro":t=1e3;break;default:t=100}scoreEnemyFin(e,t)}function scoreEnemyFin(e,t){score(e,t,!0)}function moveSimple(e){e.direction!=e.moveleft&&(e.moveleft?(e.xvel=-e.speed,e.noflip||unflipHoriz(e)):(e.noflip||flipHoriz(e),e.xvel=e.speed),e.direction=e.moveleft)}function moveSmart(e){moveSimple(e),0!=e.yvel||e.resting&&!offResting(e)||(e.moveleft?shiftHoriz(e,unitsize,!0):shiftHoriz(e,-unitsize,!0),e.moveleft=!e.moveleft)}function offResting(e){return e.moveleft?e.right-unitsize<e.resting.left:e.left+unitsize>e.resting.right}function moveJumping(e){moveSimple(e),e.resting&&(e.yvel=-abs(e.jumpheight),e.resting=!1)}function moveFloating(e){setPlatformEndpoints(e),e.begin=map.floor*unitsize-e.begin,e.end=map.floor*unitsize-e.end,(e.movement=moveFloatingReal)(e)}function moveFloatingReal(e){e.top<e.end?e.yvel=min(e.yvel+unitsized32,e.maxvel):e.bottom>e.begin&&(e.yvel=max(e.yvel-unitsized32,-e.maxvel)),movePlatformNorm(e)}function moveSliding(e){setPlatformEndpoints(e),(e.movement=moveSlidingReal)(e)}function moveSlidingReal(e){gamescreen.left+e.left<e.begin?e.xvel=min(e.xvel+unitsized32,e.maxvel):gamescreen.left+e.right>e.end&&(e.xvel=max(e.xvel-unitsized32,-e.maxvel)),movePlatformNorm(e)}function setPlatformEndpoints(e){if(e.begin>e.end){var t=e.begin;e.begin=e.end,e.end=t}}function collideTransport(e,t){characterTouchedSolid(e,t),t==e.resting&&(t.movement=movePlatformNorm,t.collide=characterTouchedSolid,t.xvel=unitsized2)}function moveFalling(e){if(e!=player.resting)return e.yvel=0;shiftVert(e,e.yvel+=unitsized8),setBottom(player,e.top),e.yvel>=2.8*unitsize&&(e.freefall=!0,e.movement=moveFreeFalling)}function moveFallingScale(e){player.resting==e?(shiftScaleStringVert(e,e.string,e.yvel+=unitsized16),shiftScaleStringVert(e.partner,e.partner.string,-e.yvel),e.tension+=e.yvel,e.partner.tension-=e.yvel):e.yvel>0&&(shiftScaleStringVert(e,e.string,e.yvel-=unitsized32),shiftScaleStringVert(e.partner,e.partner.string,-e.yvel),e.tension-=e.yvel,e.partner.tension+=e.yvel),e.partner.tension<=0&&(e.collide=e.partner.collide=characterTouchedSolid,e.movement=e.partner.movement=moveFreeFalling)}function moveFreeFalling(e){shiftVert(e,e.yvel+=unitsized16),e.yvel>unitsizet2&&(e.movement=function(e){shiftVert(e,e.yvel)})}function shiftScaleStringVert(e,t,i){shiftVert(e,i),t.bottom=e.top,t.height=(t.bottom-t.top)/unitsize,updateSize(t)}function setClass(e,t){e.className=t,setThingSprite(e)}function setClassInitial(e,t){e.className=t}function addClass(e,t){e.className+=" "+t,setThingSprite(e)}function removeClass(e,t){e.className=e.className.replace(new RegExp(" "+t,"gm"),""),setThingSprite(e)}function switchClass(e,t,i){removeClass(e,t),addClass(e,i)}function removeClasses(e){var t,i,n;for(i=1;i<arguments.length;++i)for((t=arguments[i])instanceof Array||(t=t.split(" ")),n=t.length-1;n>=0;--n)removeClass(e,t[n])}function addClasses(e,t){for(var i=t instanceof Array?t:t.split(" "),n=i.length-1;n>=0;--n)addClass(e,i[n])}function addElementClass(e,t){e.className+=" "+t}function removeElementClass(e,t){e.className=e.className.replace(new RegExp(" "+t,"gm"),"")}function flipHoriz(e){addClass(e,"flipped")}function flipVert(e){addClass(e,"flip-vert")}function unflipHoriz(e){removeClass(e,"flipped")}function unflipVert(e){removeClass(e,"flip-vert")}function deleteThing(e,t,i){t.splice(i,1),e.ondelete&&e.ondelete()}function switchContainers(e,t,i){t.splice(t.indexOf(e),1),i.push(e)}function containerForefront(e,t){t.splice(t.indexOf(e),1),t.unshift(e)}function killNormal(e){e&&(e.hidden=e.dead=!0,e.alive=e.resting=e.movement=!1,TimeHandler.clearAllCycles(e))}function killFlip(e,t){flipVert(e),e.bottomBump=function(){},e.nocollide=e.dead=!0,e.resting=e.movement=e.speed=e.xvel=e.nofall=!1,e.yvel=-unitsize,TimeHandler.addEvent((function(e){killNormal(e)}),70+(t||0))}function generalMovement(e,t,i,n){var o=setInterval((function(){shiftVert(e,i),shiftHoriz(e,t)}),timer);setTimeout((function(){clearInterval(o)}),n)}function blockBumpMovement(e){var t=-3,i=setInterval((function(){shiftVert(e,t),3.5==(t+=.5)&&(clearInterval(i),e.up=!1),determineThingCollisions(e)}),timer)}function emergeUp(e,t){AudioPlayer.play("Powerup Appears"),flipHoriz(e),e.nomove=e.nocollide=e.alive=e.nofall=e.emerging=!0,switchContainers(e,characters,scenery);var i=setInterval((function(){shiftVert(e,-unitsized8),e.bottom<=t.top&&(clearInterval(i),switchContainers(e,scenery,characters),e.nocollide=e.nomove=e.moveleft=e.nofall=e.emerging=!1,e.emergeOut&&e.emergeOut(e,t),e.movement&&(e.movementsave=e.movement,e.movement=moveSimple,e.moving=TimeHandler.addEventInterval((function(e,t){if(e.resting!=t)return TimeHandler.addEvent((function(e){e.movement=e.movementsave}),1,e),!0}),1,1/0,e,t)))}),timer)}function flicker(e,t,i){t=round(t)||49,i=round(i)||3;e.flickering=!0,TimeHandler.addEventInterval((function(e){e.hidden=!e.hidden}),i,t,e),TimeHandler.addEvent((function(e){e.flickering=e.hidden=!1}),t*i+1,e)}function killOtherCharacters(){var e,t;if(window.characters)for(t=characters.length-1;t>=0;--t)(e=characters[t]).nokillend?e.killonend&&e.killonend(e):deleteThing(e,characters,t);if(window.solids)for(t=solids.length-1;t>=0;--t)solids[t].killonend&&deleteThing(solids[t],solids,t)}function lookTowardPlayer(e,t){player.right<=e.left?e.lookleft&&!t||(e.lookleft=!0,e.moveleft=!1,unflipHoriz(e)):player.left>=e.right&&(e.lookleft||t)&&(e.lookleft=!1,e.moveleft=!0,flipHoriz(e))}function lookTowardThing(e,t){t.right<=e.left?(e.lookleft=!0,e.moveleft=!1,unflipHoriz(e)):t.left>=e.right&&(e.lookleft=!1,e.moveleft=!0,flipHoriz(e))}window.onload=function(){FullScreenMario()};