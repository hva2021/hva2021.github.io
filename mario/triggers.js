function resetTriggers(){window.controls=new Controls({left:[37,65,"AXIS_LEFT","DPAD_LEFT"],right:[39,68,"AXIS_RIGHT","DPAD_RIGHT"],up:[38,87,32,"FACE_1","DPAD_UP","LEFT_BOTTOM_SHOULDER"],down:[40,83,"AXIS_DOWN","DPAD_DOWN"],sprint:[16,17,"FACE_1"],pause:[80,"START_FORWARD"],mute:[77],q:[81],l:[76]}),window.gamepad=new Gamepad,gamepad.bind(Gamepad.Event.BUTTON_DOWN,ControlsPipe("keydown",!0)),gamepad.bind(Gamepad.Event.BUTTON_UP,ControlsPipe("keyup",!1)),gamepad.bind(Gamepad.Event.AXIS_CHANGED,(function(e){var n=e.value,o=abs(n);if(!(o<.1))switch(e.axis){case"LEFT_STICK_Y":case"RIGHT_STICK_Y":o>.5?keydown(n>0?"DPAD_DOWN":"DPAD_UP"):(keyup("DPAD_UP"),keyup("DPAD_DOWN"));break;case"LEFT_STICK_X":case"RIGHT_STICK_X":o>.5?keydown(n<0?"DPAD_LEFT":"DPAD_RIGHT"):(keyup("DPAD_UP"),keyup("DPAD_DOWN"))}})),gamepad.init(),proliferate(body,{onkeydown:ControlsPipe("keydown",!0),onkeyup:ControlsPipe("keyup",!1),oncontextmenu:contextmenu,onmousedown:mousedown}),setMessageTriggers()}function Controls(e,n){this.pipes=e;var o,t,i,a,r=this.keydown={left:function(e){e.run=-1,e.left_down=!0},right:function(e){e.run=1,e.right_down=!0},up:function(e){e.up=!0,player.canjump&&(player.resting||map.underwater)&&(e.jump=1,player.canjump=e.jumplev=0,AudioPlayer.play(player.power>1?"Jump Super":"Jump Small"),map.underwater&&setTimeout((function(){player.jumping=e.jump=!1}),14*timer))},down:function(e){e.crouch=!0},sprint:function(e){3!=player.power||0!=e.sprint||e.crouch||player.fire(),e.sprint=1},pause:function(e){paused||window.editing&&!editor.playing||setTimeout((function(){pause(!0)}),140)},mute:function(e){AudioPlayer.toggleMute()},q:function(e){switch(++qcount>28&&maxlulz(),qcount){case 7:lulz();break;case 14:superlulz();break;case 21:hyperlulz()}},l:function(e){toggleLuigi()}},u=this.keyup={left:function(e){e.run=0,e.left_down=!1},right:function(e){e.run=0,e.right_down=!1},up:function(e){map.underwater||(e.jump=e.up=0),player.canjump=!0},down:function(e){e.crouch=0,removeCrouch()},sprint:function(e){e.sprint=0},pause:function(e){unpause(!0)}};for(o in e)for(a in t=e[o])r[i=t[a]]=r[o],u[i]=u[o]}function ControlsPipe(e,n){var o=controls[e];return function(t){n&&(player&&player.dead||window.paused)||window.nokeys||(("number"!=typeof t||t.which||t.control)&&(t=t.which||t.control),o[t]?o[t](player.keys):mlog(e,"Could not",e,t),window.gamehistory[gamecount]=[keydown,t])}}function keydown(e){if(!(player&&player.dead||window.paused||window.nokeys)){var n=controls.keydown;("object"==typeof e||e.which)&&(e=e.which),n[e]&&n[e](player.keys),window.gamehistory[gamecount]=[keydown,e]}}function keyup(e){if(!window.nokeys){var n=controls.keyup;("object"==typeof e||e.which)&&(e=e.which),n[e]&&n[e](player.keys),window.gamehistory[gamecount]=[keyup,e]}}function contextmenu(e){e.preventDefault&&e.preventDefault()}function mousedown(e){3==e.which&&(paused?unpause():window.editor&&(editing||editor.playing)||pause(!0),e.preventDefault&&e.preventDefault())}function scriptKeys(e){var n,o;for(n in e)o=e[n],TimeHandler.addEvent(o[0],n,o[1]),TimeHandler.addEvent((function(){alert(o[0].name+", "+o[1])}),n)}function lulz(e,n){player.star=!0,e=e||[Goomba],n=n||7,TimeHandler.addEventInterval((function(){if(!(characters.length>210)){var n=new Thing(e[randInt(e.length)],randBoolJS(),randBoolJS());n.yvel=random()*-unitsizet4,n.xvel=n.speed=random()*unitsizet2*randSign(),addThing(n,(32*random()+128)*unitsize,88*random()*unitsize)}}),n,1/0)}function superlulz(){lulz([Goomba,Koopa,Beetle,HammerBro,Lakitu,Podoboo,Blooper])}function hyperlulz(){lulz([Bowser],21)}function maxlulz(){TimeHandler.addEventInterval((function(e){setAreaSetting(e[randInt(e.length)])}),7,1/0,["Overworld","Underworld","Underwater","Sky","Castle"])}function setMessageTriggers(){var e={setMap:triggerSetMap,startEditor:function(){loadEditor()},toggleOption:function(e){var n="toggle"+e.option;window[n]?window[n]():log("Could not toggle",n)}};window.addEventListener("message",(function(n){var o=n.data,t=o.type;e[t]&&e[t](o)}))}function triggerSetMap(e){clearPlayerStats(),setMap.apply(this,e.map||[]),setLives(3)}